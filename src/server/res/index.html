<html>
  <head>
    <title>Visualizer</title>
    <meta charset=utf-8>
    <style>
			body { 
				margin: 0; 
				background-color: #f0f0f0;
			}
			canvas { 
				width: 100%; 
				height: 100% 
			}
		</style>
  </head>
  <body>
    <script src="three.min.js"></script>
		<script>
			var sendRequest = function(callback) {
				var xhr = new XMLHttpRequest();

				xhr.onreadystatechange = function () {
					if (this.readyState != 4) return;

					if (this.status == 200) {
						console.log(this.responseText);
						var data = JSON.parse(this.responseText.replace(new RegExp(';', 'g'), ','));
						callback(data);
					}

					// end of state change: it can be after some time (async)
				};

				xhr.open("POST", "/get_matrix", true);
				xhr.setRequestHeader('Content-Type', 'application/json');
				xhr.send();
			}

		</script>
		<script>
			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 1, 1000 );

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			var geometry = new THREE.BoxGeometry( 1, 1, 1 );
			var material = new THREE.MeshNormalMaterial();
			var cube = new THREE.Mesh( geometry, material );
			scene.add( cube );
			scene.background = new THREE.Color( 0xffffff );

			camera.position.z = 10;
			camera.position.y = 4;
			camera.lookAt(new THREE.Vector3(0,0,0));

			cube.matrixAutoUpdate = false;

			var render = function () {
				requestAnimationFrame( render );

				renderer.render(scene, camera);
			};

			render();

			var updateMat = function() {
				sendRequest(function(data) {
					cube.matrix.set(
						data[0], data[1], data[2], data[3],
						data[4], data[5], data[6], data[7],
						data[8], data[9], data[10], data[11],
						data[12], data[13], data[14], data[15],
					);
					setTimeout(updateMat, 1000);
				});
			}

			updateMat();
		</script>
  </body>
</html>